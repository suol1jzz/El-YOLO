# Ultralytics YOLO 🚀, AGPL-3.0 license
# 修改版本：移除 C2PSA 模块 (原层8)

# Parameters
nc: 80
scales: # 调整 depth 系数以匹配层数减少
  # [depth, width, max_channels]
  n: [0.50, 0.25, 1024] # depth 减少约 0.1 (原319层 → 317层)
  s: [0.50, 0.50, 1024]
  m: [0.50, 1.00, 512]
  l: [1.00, 1.00, 512]
  x: [1.00, 1.50, 512]

backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 6, 2, 2]] # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]]   # 1-P2/4
  - [-1, 3, C3, [128]]           # 2

  - [-1, 1, Conv, [256, 3, 2]]   # 3-P3/8
  - [-1, 6, C3, [256]]           # 4

  - [-1, 1, Conv, [512, 3, 2]]   # 5-P4/16
  - [-1, 9, C3, [512]]           # 6
  - [-1, 1, SPPF, [1024, 5]]     # 7-P5/32 (原层8变为层7)

# 删除原层8的 C2PSA

head:
  # ----------------- Stage: 跨层融合 -----------------
  # 所有原层号 >=8 的引用需减1
  - [ 2, 1, Conv,[ 256, 1, 1]]         # 8-p3/16 (原层9)
  - [ 4, 1, Conv,[ 512, 1, 1 ]]        # 9-p4/16 (原层10)
  - [ 7, 1, Conv,[ 1024, 1, 1]]        # 10-p5/32 (原层11引用改为当前层7)

  - [9, 1, ResUpDownSample, [256,"up"]] # 11 (原层12)
  - [[8,11], 1, FeatureFusion,[[256,256],"asff2"]] # 12 (原层13)

  - [8, 1, ResUpDownSample, [512,"down"]] #13 (原层14)
  - [[9,13], 1, FeatureFusion,[[512,512],"asff2"]] #14 (原层15)
  - [7, 1, ResUpDownSample, [512,"up"]] #15 (原层16引用改为层7)
  - [[15,14], 1, ACBiFPN,[512,2]] #16 (原层17)

  - [16, 1, ResUpDownSample,[256,"up"]] #17 (原层18)
  - [[17,12], 1, ACBiFPN, [256,2]] #18 (原层19)
  - [-1, 2, C3k2_DWSConv, [256, False]] #19 (原层20)

  - [16, 2, C3k2_DWSConv, [512, False]] #20 (原层21)

  - [20, 1, ResUpDownSample,[256,"up"]] #21 (原层22)
  - [[21,19], 1, FeatureFusion,[[256,256],"asff2"]] #22 (原层23)

  - [19, 1, ResUpDownSample, [512,"down"]] #23 (原层24)
  - [10, 1, ResUpDownSample, [512,"up"]] #24 (原层25引用改为层10)
  - [[20,23,24], 1 ,FeatureFusion, [[512,512],"asff3"]] #25 (原层26)

  - [20, 1, ResUpDownSample, [1024,"down"]] #26 (原层27)
  - [[10,26], 1, FeatureFusion,[[1024,1024],"asff2"]] #27 (原层28)
  - [27, 2, C3k2_DWSConv, [1024, False]] #28 (原层29)

  - [27, 1, ResUpDownSample, [512,"up"]] #29 (原层30)
  - [[25,29], 1, ACBiFPN,[512,2]] #30 (原层31)
  - [27, 2, C3k2_DWSConv, [512, False]] #31 (原层32)

  - [30, 1, ResUpDownSample, [256,"up"]] #32 (原层33)
  - [[22,32], 1, ACBiFPN,[256,2]] #33 (原层34)
  - [33, 2, C3k2_DWSConv, [256, False]] #34 (原层35)

  # ----------------- 检测头连接 -----------------
  - [[34, 31, 28], 1, Detect, [nc]] # 对应P3/8, P4/16, P5/32